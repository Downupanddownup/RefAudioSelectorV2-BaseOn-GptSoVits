<!DOCTYPE html>
<script>
  const TaskDetailSpace = (function () {
    class C_TaskDetail {
      constructor(viewId, taskId) {
        this.viewId = viewId
        this.taskId = taskId
        this.task = null
        this.gptModels = []
        this.vitsModels = []
        this.audioCategoryList = []
      }

      getTask(){
        return this.task
      }
      
      loadData(){
        const _this = this

        $.customAjax({
          url: BaseUrl+'task/load_inference_task_detail',
          type: 'post',
          data:{
            task_id: _this.taskId
          },
          success: function(res){
            if (res.code == 0) {
              if (_this.taskId > 0) {
                _this.task = new C_ObjInferenceTask(res.data.task)
              } else {
                _this.task = new C_ObjInferenceTask({})
              }
              console.log('拿到了task了吗？', _this.task)
              
              _this.audioCategoryList = res.data.categoryList ? res.data.categoryList.map(item=>new C_ObjInferenceCategory(item)) : []
              _this.gptModels = res.data.gptModels ? res.data.gptModels.map(item=>new C_GptModel(item)) : []
              _this.vitsModels = res.data.vitsModels ? res.data.vitsModels.map(item=>new C_VitsModel(item)) : []
              
              _this.render()
            } else {
              layui.layer.msg(res.msg)
            }
          },
          error: function(res, msg){
            layui.layer.msg(msg)
          }
        })
        
      }
      
      render() {
        const _this = this
        const getTpl = $('#taskDetailTemplate').html();
        // 渲染并输出结果
        layui.laytpl(getTpl).render(_this, function(html){
          const obj = $('#'+_this.viewId)
          obj.html(html)

          layui.element.render('collapse');
          
          obj.find('#taskName').on('blur', function(){
            _this.task.taskName = $(this).val()
          })

          obj.find('#compareType').on('change', function(){
            const compareType = $(this).val()
            _this.task.compareType = compareType
            _this.task.compareParams = []
            if (compareType) {
              _this.task.compareParams.push(new C_ObjInferenceTaskCompareParams({}))
            }
            _this.render()
          })
          
          if (_this.task.compareType === 'refer_audio') {
            xmSelect.render({
              el: '#'+_this.viewId+' #audioCategory',
              data: _this.audioCategoryList.map(item => {
                const selected = _this.task.compareParams.find(param => item.name === param.audioCategory)
                return {
                  name: item.name,
                  value: item.name,
                  selected: !!selected
                }
              }),
              on: function(data){
                //arr:  当前多选已选中的数据
                var arr = data.arr;
                //change, 此次选择变化的数据,数组
                var change = data.change;
                //isAdd, 此次操作是新增还是删除
                var isAdd = data.isAdd;

                _this.task.compareParams = arr.map(item => new C_ObjInferenceTaskCompareParams({audioCategory: item.value}))
                
                //可以return一个数组, 代表想选中的数据
                //return []
              },
            })
          }
          
          obj.find('button[data-add]').on('click', function(){
            const index = $(this).data('add')
            _this.task.compareParams.splice(index+1, 0, new C_ObjInferenceTaskCompareParams({}))
            _this.render()
          })
          
          obj.find('button[data-delete]').on('click', function(){
            const index = $(this).data('delete')
            _this.task.compareParams.splice(index, 1)
            _this.render()
          })
          
          obj.find('select[data-params-gsv-version]').on('change', function(){
            const index = $(this).data('params-gsv-version')
            _this.task.compareParams[index].gptSovitsVersion = $(this).val()
            _this.task.compareParams[index].gptModelName = ''
            _this.task.compareParams[index].vitsModelName = ''
            _this.render()
          })
          
          obj.find('select[data-params-gpt-model]').on('change', function(){
            const index = $(this).data('params-gpt-model')
            _this.task.compareParams[index].gptModelName = $(this).val()
          })
          
          obj.find('select[data-params-vits-model]').on('change', function(){
            const index = $(this).data('params-vits-model')
            _this.task.compareParams[index].vitsModelName = $(this).val()
          })
          
          obj.find('input[data-params-top-k]').on('blur', function(){
            const index = $(this).data('params-top-k')
            _this.task.compareParams[index].topK = $(this).val()
          })
          
          obj.find('input[data-params-top-p]').on('blur', function(){
            const index = $(this).data('params-top-p')
            _this.task.compareParams[index].topP = $(this).val()
          })
          
          obj.find('input[data-params-temperature]').on('blur', function(){
            const index = $(this).data('params-temperature')
            _this.task.compareParams[index].temperature = $(this).val()
          })
          
          obj.find('input[data-params-speed]').on('blur', function(){
            const index = $(this).data('params-speed')
            _this.task.compareParams[index].speed = $(this).val()
          })
          
          obj.find('input[data-params-text-delimiter]').on('blur', function(){
            const index = $(this).data('params-text-delimiter')
            _this.task.compareParams[index].textDelimiter = $(this).val()
          })
          
          obj.find('button[data-inp-refs-audio-select]').on('click', function(){
            const index = $(this).data('inp-refs-audio-select')
            _this.openParamInpRefsAudioSelectDialog(index)
          })
          
          obj.find('input[data-params-other]').on('blur', function(){
            const index = $(this).data('params-other')
            _this.task.compareParams[index].otherParameters = $(this).val()
          })
          
          obj.find('#gsvVersion').on('change', function() {
            _this.task.gptSovitsVersion = $(this).val()
            _this.task.gptModelName = ''
            _this.task.vitsModelName = ''
            _this.render()
          })
          
          obj.find('#gptModel').on('change', function() {
            _this.task.gptModelName = $(this).val()
          })
          
          obj.find('#vitsModel').on('change', function() {
            _this.task.vitsModelName = $(this).val()
          })
          
          obj.find('#topK').on('blur', function(){
            _this.task.topK = $(this).val()
          })
          
          obj.find('#topP').on('blur', function(){
            _this.task.topP = $(this).val()
          })
          
          obj.find('#temperature').on('blur', function(){
            _this.task.temperature = $(this).val()
          })
          
          obj.find('#textDelimiter').on('blur', function(){
            _this.task.textDelimiter = $(this).val()
          })
          
          obj.find('#speed').on('blur', function(){
            _this.task.speed = $(this).val()
          })
          
          obj.find('#other').on('blur', function(){
            _this.task.otherParameters = $(this).val()
          })
          
          obj.find('#audioSelect').on('click', function() {
            _this.openAudioSelectDialog()
          })
          
          obj.find('#inpRefsAudioSelect').on('click', function() {
            _this.openInpRefsAudioSelectDialog()
          })
          
          obj.find('#textManager').on('click', function() {
            _this.openTextManagerDialog()
          })
          
          obj.find('#modelManager').on('click', function() {
            _this.openModelFile()
          })
          
          obj.find('button[data-refresh-model]').on('click', function() {
            _this.reloadModelList()
          })

          setTips('input[id="taskName"]','设置此对比任务名称')
          setTips('select[id="compareType"]','选择需要对比的GptSoVits模型参数类型')
          setTips('div[id="audioCategory"]','选择需要参与对比的参考音频分类，选择后此类别下的所有3-10s内的参考音频将参与推理')
          setTips('button[data-add]','添加新的参数对比组')
          setTips('button[data-delete]','删除当前对比组')
          
          setTips('select[data-params-gsv-version]',SysConfig.tippyDesc.gptSovitsVersion)
          setTips('select[data-params-gpt-model]',SysConfig.tippyDesc.gptModelName)
          setTips('select[data-params-vits-model]',SysConfig.tippyDesc.vitsModelName)
          setTips('input[data-params-top-k]',SysConfig.tippyDesc.topK)
          setTips('input[data-params-top-p]',SysConfig.tippyDesc.topP)
          setTips('input[data-params-temperature]',SysConfig.tippyDesc.temperature)
          setTips('input[data-params-speed]',SysConfig.tippyDesc.speed)
          setTips('input[data-params-text-delimiter]',SysConfig.tippyDesc.textDelimiter)
          setTips('button[data-inp-refs-audio-select]',SysConfig.tippyDesc.inpRefsList)
          
          

          setTips('select[id="gsvVersion"]',SysConfig.tippyDesc.gptSovitsVersion)
          setTips('button[id="modelManager"]','打开模型管理目录，将GptSoVits微调得到的两类模型按照版本放入到此目录下')
          setTips('select[id="gptModel"]',SysConfig.tippyDesc.gptModelName)
          setTips('button[data-refresh-model]','点击后重新加载模型列表')
          setTips('select[id="vitsModel"]',SysConfig.tippyDesc.vitsModelName)
          setTips('input[id="topK"]',SysConfig.tippyDesc.topK)
          setTips('input[id="topP"]',SysConfig.tippyDesc.topP)
          setTips('input[id="temperature"]',SysConfig.tippyDesc.temperature)
          setTips('input[id="textDelimiter"]',SysConfig.tippyDesc.textDelimiter)
          setTips('input[id="speed"]',SysConfig.tippyDesc.speed)

          setTips('button[id="audioSelect"]','选择需要参与推理的参考音频')
          setTips('button[id="inpRefsAudioSelect"]',SysConfig.tippyDesc.inpRefsList)
          setTips('button[id="textManager"]','选择需要推理的文本')
          
        });
      }

      reloadModelList(){
        const _this = this
        $.customAjax({
          url: BaseUrl+'task/load_model_list',
          type: 'post',
          success: function(res){
            if (res.code == 0) {
              _this.gptModels = res.data.gptModels ? res.data.gptModels.map(item=>new C_GptModel(item)) : []
              _this.vitsModels = res.data.vitsModels ? res.data.vitsModels.map(item=>new C_VitsModel(item)) : []
              _this.render()
            } else {
              layui.layer.msg(res.msg)
            }
          },
          error: function(res, msg){
            layui.layer.msg(msg)
          }
        })
      }

      openModelFile(){
        $.customAjax({
          url: BaseUrl+'task/open_model_file',
          type: 'post',
          success: function(res){
            if (res.code == 0) {
            } else {
              layer.msg(res.msg)
            }
          },
          error: function(res, msg){
            layer.msg(msg)
          }
        })
      }

      openAudioSelectDialog(){
        const _this = this

        const C_ReferenceSelect$1 = ReferenceSelectSpace.getReferenceSelect('audioSelectView',_this.task.taskAudioList.map(data=>{
          return {
            id:data.audioId, // id
            audioName:data.audioName, // 音频名称
            audioPath:data.audioPath, // 音频路径
            content:data.audioContent, // 音频内容
            language:data.audioLanguage, // 音频语种
            category:data.audioCategory, // 音频分类
            audioLength:data.audioLength, // 音频时长
          }
        }))
        
        const dialogId = layer.open({
          type: 1,
          area: [SysConfig.defaultDialogWidth, SysConfig.defaultDialogHeight],
          content: `<div id="audioSelectView" style="height: 100%"></div>`,
          btn: ['确定', '取消'],
          yes: function(){
            const selectedAudioList = C_ReferenceSelect$1.getAllSelectedAudioList()
            _this.task.taskAudioList = selectedAudioList.map(data => {
              return new C_ObjInferenceTaskAudio({
                audioId:data.id, // id
                audioName:data.audioName, // 音频名称
                audioPath:data.audioPath, // 音频路径
                audioContent:data.content, // 音频内容
                audioLanguage:data.language, // 音频语种
                audioCategory:data.category, // 音频分类
                audioLength:data.audioLength, // 音频时长
              })
            })
            layui.layer.close(dialogId)
            $('#' + _this.viewId + ' #audioSelectedCount').html(_this.task.taskAudioList.length)
          }
        });

        
        C_ReferenceSelect$1.loadData()
      }



      openParamInpRefsAudioSelectDialog(index){
        const _this = this
        
        const param = _this.task.compareParams[index]

        const inpRefsAudioDialog = TaskSoundFusionSelectSpace.getTaskSoundFusionSelect('inpRefsAudioSelectView',param.inpRefsAudioList.map(data=>{
          return {
            id:data.audioId, // id
            audioName:data.audioName, // 音频名称
            roleName:data.roleName, // 角色名称
            audioPath:data.audioPath, // 音频路径
            content:data.content, // 音频内容
            language:data.language, // 音频语种
            category:data.category, // 音频分类
            audioLength:data.audioLength, // 音频时长
            remark:data.remark, // 备注
          }
        }))

        const dialogId = layer.open({
          type: 1,
          area: [SysConfig.defaultDialogWidth, SysConfig.defaultDialogHeight],
          content: `<div id="inpRefsAudioSelectView" style="height: 100%"></div>`,
          btn: ['确定', '取消'],
          yes: function(){
            const selectedAudioList = inpRefsAudioDialog.getAllSelectedAudioList()
            console.log('selectedAudioList',selectedAudioList)
            param.inpRefsAudioList = selectedAudioList.map(data => {
              return new C_ObjInferenceTaskSoundFusionAudio({
                audioId:data.id, // id
                audioName:data.audioName, // 音频名称
                roleName:data.roleName, // 角色名称
                audioPath:data.audioPath, // 音频路径
                content:data.content, // 音频内容
                language:data.language, // 音频语种
                category:data.category, // 音频分类
                audioLength:data.audioLength, // 音频时长
                remark:data.remark, // 音频时长
              })
            })
            console.log('task', _this.task)
            layui.layer.close(dialogId)
            $('#' + _this.viewId + ' [data-inp-refs-select-count=' + index + ']').html(param.inpRefsAudioList.length)
          }
        });


        inpRefsAudioDialog.render()
      }

      openInpRefsAudioSelectDialog(){
        const _this = this

        const inpRefsAudioDialog = TaskSoundFusionSelectSpace.getTaskSoundFusionSelect('inpRefsAudioSelectView',_this.task.taskInpRefsAudioList.map(data=>{
          return {
            id:data.audioId, // id
            audioName:data.audioName, // 音频名称
            roleName:data.roleName, // 角色名称
            audioPath:data.audioPath, // 音频路径
            content:data.content, // 音频内容
            language:data.language, // 音频语种
            category:data.category, // 音频分类
            audioLength:data.audioLength, // 音频时长
            remark:data.remark, // 备注
          }
        }))
        
        const dialogId = layer.open({
          type: 1,
          area: [SysConfig.defaultDialogWidth, SysConfig.defaultDialogHeight],
          content: `<div id="inpRefsAudioSelectView" style="height: 100%"></div>`,
          btn: ['确定', '取消'],
          yes: function(){
            const selectedAudioList = inpRefsAudioDialog.getAllSelectedAudioList()
            _this.task.taskInpRefsAudioList = selectedAudioList.map(data => {
              return new C_ObjInferenceTaskSoundFusionAudio({
                audioId:data.id, // id
                audioName:data.audioName, // 音频名称
                roleName:data.roleName, // 角色名称
                audioPath:data.audioPath, // 音频路径
                content:data.content, // 音频内容
                language:data.language, // 音频语种
                category:data.category, // 音频分类
                audioLength:data.audioLength, // 音频时长
                remark:data.remark, // 音频时长
              })
            })
            layui.layer.close(dialogId)
            $('#' + _this.viewId + ' #inpRefsAudioSelectedCount').html(_this.task.taskInpRefsAudioList.length)
          }
        });


        inpRefsAudioDialog.render()
      }

      openTextManagerDialog(){
        const _this = this

        const C_TextManager$1 = TextManagerSpace.getTextManager('textManagerView', _this.task.taskTextList.map(data=>{
          return {
            id: data.textId, // 自增编号
            category: data.category, // 文本分类
            textContent: data.textContent, // 推理文本
            textLanguage: data.textLanguage // 文本语种
          }
        }))
        
        const dialogId = layer.open({
          type: 1,
          area: [SysConfig.defaultDialogWidth, SysConfig.defaultDialogHeight],
          content: `<div id="textManagerView" style="height: 100%"></div>`,
          btn: ['确定', '取消'],
          yes: function(){
            const selectedTextList = C_TextManager$1.getAllSelectedTextList()
            _this.task.taskTextList = selectedTextList.map(data => {
              return new C_ObjInferenceTaskText({
                textId: data.id,
                category: data.category,
                textContent: data.textContent,
                textLanguage: data.textLanguage
              })
            })
            layui.layer.close(dialogId)
            $('#' + _this.viewId + ' #textManagerSelectedCount').html(_this.task.taskTextList.length)
          }
        });
       
        C_TextManager$1.render()
      }

    }

    function getTaskDetail(viewId, taskId) {
      return new C_TaskDetail(viewId, taskId)
    }

    return {
      getTaskDetail: getTaskDetail
    }
  })()
</script>

<script id="taskDetailTemplate" type="text/html">

  <fieldset class="layui-elem-field layui-field-title">
    <legend>任务名称</legend>
  </fieldset>
  
  <table class="table3">
    <tr>
      <td>
        <input type="text" autocomplete="off" id="taskName" placeholder="任务名称" class="layui-input" style="width: auto;" value="{{d.task.taskName}}">
      </td>
    </tr>
  </table>
  
  <fieldset class="layui-elem-field layui-field-title">
    <legend>对比参数</legend>
  </fieldset>

  <div class="layui-collapse" lay-accordion="">
    <div class="layui-colla-item">
      <h2 class="layui-colla-title">更多</h2>
      <div class="layui-colla-content layui-show">

        <table class="table1">
          <tr>
            <td>比较变量类型：</td>
            <td colspan="2">
              <select class="customSelect" id="compareType">
                <option value="">请选择</option>
                <option {{isTrue(d.task.compareType=="refer_audio",'selected','')}} value="refer_audio">参考音频</option>
                <option {{isTrue(d.task.compareType=="gpt_model",'selected','')}} value="gpt_model">GPT模型</option>
                <option {{isTrue(d.task.compareType=="vits_model",'selected','')}} value="vits_model">Vits模型</option>
                <option {{isTrue(d.task.compareType=="top_k",'selected','')}} value="top_k">top_k值</option>
                <option {{isTrue(d.task.compareType=="top_p",'selected','')}} value="top_p">top_p值</option>
                <option {{isTrue(d.task.compareType=="temperature",'selected','')}} value="temperature">temperature值</option>
                <option {{isTrue(d.task.compareType=="speed",'selected','')}} value="speed">speed值</option>
                <option {{isTrue(d.task.compareType=="text_delimiter",'selected','')}} value="text_delimiter">文本分隔符</option>
                <option {{isTrue(d.task.compareType=="inp_refs",'selected','')}} value="inp_refs">音色融合</option>
                <option {{isTrue(d.task.compareType=="kpt",'selected','')}} value="kpt">top_k、top_p、temperature</option>
                <option {{isTrue(d.task.compareType=="gv",'selected','')}} value="gv">Gpt与Vits模型</option>
                <option {{isTrue(d.task.compareType=="all",'selected','')}} value="all">所有参数</option>
              </select>
            </td>
          </tr>
          
          {{# if (d.task.compareType == 'refer_audio') { }}
          <tr>
            <td>
              选择分类：
            </td>
            <td colspan="2" style="text-align: center">
              <div id="audioCategory" style="width: 200px;margin: auto"></div>
            </td>
          </tr>
          {{# } else if (d.task.compareType && d.task.compareType != 'refer_audio') { }} 
          
           {{# layui.each(d.task.compareParams, function(index, item){ }}
          
            {{# if (d.task.compareType == 'gpt_model') { }}
              <tr>
                <td>
                  第{{index+1}}组：
                </td>
                <td>
                  <select class="customSelect" data-params-gsv-version="{{index}}">
                    <option {{isTrue('v1'==item.gptSovitsVersion,'selected','')}} value="v1">v1</option>
                    <option {{isTrue('v2'==item.gptSovitsVersion,'selected','')}} value="v2">v2</option>
                    <option {{isTrue('v3'==item.gptSovitsVersion,'selected','')}} value="v3">v3</option>
                  </select>
                  <select class="customSelect" data-params-gpt-model="{{index}}">
                    <option value="">请选择</option>
                    {{# layui.each(d.gptModels, function(index, model){ }}
                      {{# if (item.gptSovitsVersion == model.version) { }}
                        <option {{isTrue(model.name==item.gptModelName,'selected','')}} value="{{model.name}}">{{model.name}}</option>
                      {{# } }}
                    {{# }) }}
                  </select>
                </td>
                <td>
                  <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
                  <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
                </td>
              </tr>
            {{# } else if (d.task.compareType == 'vits_model') { }}
              <tr>
                <td>
                  第{{index+1}}组：
                </td>
                <td>
                  <select class="customSelect" data-params-gsv-version="{{index}}">
                    <option {{isTrue('v1'==item.gptSovitsVersion,'selected','')}} value="v1">v1</option>
                    <option {{isTrue('v2'==item.gptSovitsVersion,'selected','')}} value="v2">v2</option>
                    <option {{isTrue('v3'==item.gptSovitsVersion,'selected','')}} value="v3">v3</option>
                  </select>
                  <select class="customSelect" data-params-vits-model="{{index}}">
                    <option value="">请选择</option>
                    {{# layui.each(d.vitsModels, function(index, model){ }}
                      {{# if (item.gptSovitsVersion == model.version) { }}
                        <option {{isTrue(model.name==item.vitsModelName,'selected','')}} value="{{model.name}}">{{model.name}}</option>
                      {{# } }}
                    {{# }) }}
                  </select>
                </td>
                <td>
                  <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
                  <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
                </td>
              </tr>
            {{# } else if (d.task.compareType == 'top_k') { }}
              <tr>
                <td>
                  第{{index+1}}组：
                </td>
                <td>
                  <input type="number" autocomplete="off" data-params-top-k="{{index}}" placeholder="top_k值"
                         class="layui-input" style="width: auto;" value="{{item.topK}}">
                </td>
                <td>
                  <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
                  <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
                </td>
              </tr>
            {{# } else if (d.task.compareType == 'top_p') { }}
          <tr>
            <td>
              第{{index+1}}组：
            </td>
            <td>
              <input type="number" autocomplete="off" data-params-top-p="{{index}}" placeholder="top_p值" 
                     class="layui-input" style="width: auto;" value="{{item.topP}}">
            </td>
            <td>
              <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
              <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
            </td>
          </tr>
            {{# } else if (d.task.compareType == 'temperature') { }}
          <tr>
            <td>
              第{{index+1}}组：
            </td>
            <td>
              <input type="number" autocomplete="off" data-params-temperature="{{index}}" placeholder="temperature值" 
                     class="layui-input" style="width: auto;" value="{{item.temperature}}">
            </td>
            <td>
              <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
              <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
            </td>
          </tr>
            {{# } else if (d.task.compareType == 'speed') { }}
          <tr>
            <td>
              第{{index+1}}组：
            </td>
            <td>
              <input type="number" autocomplete="off" data-params-speed="{{index}}" placeholder="speed值" 
                     class="layui-input" style="width: auto;" value="{{item.speed}}">
            </td>
            <td>
              <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
              <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
            </td>
          </tr>
            {{# } else if (d.task.compareType == 'text_delimiter') { }}
          <tr>
            <td>
              第{{index+1}}组：
            </td>
            <td>
              <input type="text" autocomplete="off" data-params-text-delimiter="{{index}}" placeholder="文本分隔符" 
                     class="layui-input" style="width: auto;" value="{{item.textDelimiter}}">
            </td>
            <td>
              <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
              <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
            </td>
          </tr>
            {{# } else if (d.task.compareType == 'inp_refs') { }}
          <tr>
            <td>
              第{{index+1}}组：
            </td>
            <td>
              已选中待融合音频数量：<span data-inp-refs-select-count="{{index}}">{{item.inpRefsAudioList.length}}</span>
              <button type="button" class="layui-btn layui-btn-sm" data-inp-refs-audio-select="{{index}}">音频选择</button>
            </td>
            <td>
              <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
              <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
            </td>
          </tr>
            {{# } else if (d.task.compareType == 'kpt') { }}

              <tr>
                <td>
                  第{{index+1}}组：
                </td>
                <td>
                  top_k：<input type="number" autocomplete="off" data-params-top-k="{{index}}" placeholder="top_k值"
                         class="layui-input" style="width: auto;" value="{{item.topK}}">  
                  top_p：<input type="number" autocomplete="off" data-params-top-p="{{index}}" placeholder="top_p值"
                         class="layui-input" style="width: auto;" value="{{item.topP}}"> 
                  temperature：<input type="number" autocomplete="off" data-params-temperature="{{index}}" placeholder="temperature值"
                         class="layui-input" style="width: auto;" value="{{item.temperature}}"> 
                </td>
                <td>
                  <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
                  <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
                </td>
              </tr>
          
            {{# } else if (d.task.compareType == 'gv') { }}

              <tr>
                <td>
                  第{{index+1}}组：
                </td>
                <td>
                  gsv版本：<select class="customSelect" data-params-gsv-version="{{index}}">
                    <option {{isTrue('v1'==item.gptSovitsVersion,'selected','')}} value="v1">v1</option>
                    <option {{isTrue('v2'==item.gptSovitsVersion,'selected','')}} value="v2">v2</option>
                    <option {{isTrue('v3'==item.gptSovitsVersion,'selected','')}} value="v3">v3</option>
                  </select> 
                  GPT：<select class="customSelect" data-params-gpt-model="{{index}}">
                    <option value="">请选择</option>
                    {{# layui.each(d.gptModels, function(index, model){ }}
                      {{# if (item.gptSovitsVersion == model.version) { }}
                        <option {{isTrue(model.name==item.gptModelName,'selected','')}} value="{{model.name}}">{{model.name}}</option>
                      {{# } }}
                    {{# }) }}
                  </select> 
                  SoVITS：<select class="customSelect" data-params-vits-model="{{index}}">
                    <option value="">请选择</option>
                    {{# layui.each(d.vitsModels, function(index, model){ }}
                      {{# if (item.gptSovitsVersion == model.version) { }}
                        <option {{isTrue(model.name==item.vitsModelName,'selected','')}} value="{{model.name}}">{{model.name}}</option>
                      {{# } }}
                    {{# }) }}
                  </select> 
                </td>
                <td>
                  <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
                  <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
                </td>
              </tr>
          
            {{# } else if (d.task.compareType == 'all') { }}

              <tr>
                <td>
                  第{{index+1}}组：
                </td>
                <td>
                  <table class="table1">
                    <tr>
                      <td>
                        gsv版本：<select class="customSelect" data-params-gsv-version="{{index}}">
                          <option {{isTrue('v1'==item.gptSovitsVersion,'selected','')}} value="v1">v1</option>
                          <option {{isTrue('v2'==item.gptSovitsVersion,'selected','')}} value="v2">v2</option>
                          <option {{isTrue('v3'==item.gptSovitsVersion,'selected','')}} value="v3">v3</option>
                        </select>
                      </td>
                      <td>
                        GPT：<select class="customSelect" data-params-gpt-model="{{index}}">
                          <option value="">请选择</option>
                          {{# layui.each(d.gptModels, function(index, model){ }}
                            {{# if (item.gptSovitsVersion == model.version) { }}
                              <option {{isTrue(model.name==item.gptModelName,'selected','')}} value="{{model.name}}">{{model.name}}</option>
                            {{# } }}
                          {{# }) }}
                        </select>
                      </td>
                      <td>
                        SoVITS：<select class="customSelect" data-params-vits-model="{{index}}">
                          <option value="">请选择</option>
                          {{# layui.each(d.vitsModels, function(index, model){ }}
                            {{# if (item.gptSovitsVersion == model.version) { }}
                              <option {{isTrue(model.name==item.vitsModelName,'selected','')}} value="{{model.name}}">{{model.name}}</option>
                            {{# } }}
                          {{# }) }}
                        </select>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        top_k：<input type="number" autocomplete="off" data-params-top-k="{{index}}" placeholder="top_k值"
                               class="layui-input" style="width: auto;" value="{{item.topK}}">
                      </td>
                      <td>
                        top_p：<input type="number" autocomplete="off" data-params-top-p="{{index}}" placeholder="top_p值"
                               class="layui-input" style="width: auto;" value="{{item.topP}}">
                      </td>
                      <td>
                        temperature：<input type="number" autocomplete="off" data-params-temperature="{{index}}" placeholder="temperature值"
                               class="layui-input" style="width: auto;" value="{{item.temperature}}">
                      </td>
                    </tr>
                    <tr>
                      <td>
                        文本分隔符：<input type="text" autocomplete="off" data-params-text-delimiter="{{index}}" placeholder="文本分隔符"
                               class="layui-input" style="width: auto;" value="{{item.textDelimiter}}">
                      </td>
                      <td>
                        speed：<input type="number" autocomplete="off" data-params-speed="{{index}}" placeholder="speed值"
                               class="layui-input" style="width: auto;" value="{{item.speed}}">
                      </td>
                      <td>
                        已选中待融合音频数量：<span data-inp-refs-select-count="{{index}}">{{item.inpRefsAudioList.length}}</span>
                        <button type="button" class="layui-btn layui-btn-sm" data-inp-refs-audio-select="{{index}}">音频选择</button>
                      </td>
                    </tr>
                  </table>
                </td>
                <td>
                  <button type="button" class="layui-btn layui-btn-sm" data-add="{{index}}"><i class="layui-icon"></i></button>
                  <button type="button" class="layui-btn layui-btn-sm" data-delete="{{index}}"><i class="layui-icon"></i></button>
                </td>
              </tr>
          
            {{# } }}
          
           {{# }) }}
          
          {{# } }} 
          
        </table>

      </div>
    </div>
  </div>
  
  
  {{# if (d.task.compareType) { }}


  <fieldset class="layui-elem-field layui-field-title">
    <legend>固定参数</legend>
  </fieldset>

  <div class="layui-collapse" lay-accordion="">
    <div class="layui-colla-item">
      <h2 class="layui-colla-title">更多</h2>
      <div class="layui-colla-content layui-show">

      <table class="table1">
        <tr>
          <td>
            GPT-Sovits 版本：
          </td>
          <td>

            {{# if ( d.task.compareType == 'gv' || d.task.compareType == 'all') { }}
              已作为对比变量
            {{# } else { }}

              <select class="customSelect" id="gsvVersion">
                <option {{isTrue(d.task.gptSovitsVersion=="v1",'selected','')}} value="v1">v1</option>
                <option {{isTrue(d.task.gptSovitsVersion=="v2",'selected','')}} value="v2">v2</option>
                <option {{isTrue(d.task.gptSovitsVersion=="v3",'selected','')}} value="v3">v3</option>
              </select>
              <button type="button" class="layui-btn layui-btn-sm" id="modelManager">模型管理</button>
            
            {{# } }}

          </td>
          <td>
            GPT 模型：
          </td>
          <td>
            
            {{# if (d.task.compareType == 'gpt_model' || d.task.compareType == 'gv' || d.task.compareType == 'all') { }}
              已作为对比变量
            {{# } else { }}

                <select class="customSelect" id="gptModel">
                  <option value="">请选择</option>
                  {{# layui.each(d.gptModels, function(index, item){ }}
                    {{# if (d.task.gptSovitsVersion == item.version) { }}
                      <option {{isTrue(item.name==d.task.gptModelName,'selected','')}} value="{{item.name}}">{{item.name}}</option>
                    {{# } }}
                  {{# }) }}
                </select>
                <button type="button" class="layui-btn layui-btn-sm" data-refresh-model >刷新</button>  
            
            {{# } }}
            

          </td>
          <td>
            Vits 模型：
          </td>
          <td>

            {{# if (d.task.compareType == 'vits_model' || d.task.compareType == 'gv' || d.task.compareType == 'all') { }}
            已作为对比变量
            {{# } else { }}

              <select class="customSelect" id="vitsModel">
                <option value="">请选择</option>
                {{# layui.each(d.vitsModels, function(index, item){ }}
                  {{# if (d.task.gptSovitsVersion == item.version) { }}
                    <option {{isTrue(item.name==d.task.vitsModelName,'selected','')}} value="{{item.name}}">{{item.name}}</option>
                  {{# } }}
                {{# }) }}
              </select>
              <button type="button" class="layui-btn layui-btn-sm" data-refresh-model >刷新</button>

            {{# } }}
            
          </td>
        </tr>
        <tr>
          <td>
            top_k值：
          </td>
          <td>

            {{# if (d.task.compareType == 'top_k' || d.task.compareType == 'kpt' || d.task.compareType == 'all') { }}
            已作为对比变量
            {{# } else { }}

              <input type="number" autocomplete="off" id="topK" placeholder="top_k值" class="layui-input" style="width: auto;" value="{{d.task.topK}}">

            {{# } }}
          </td>
          <td>
            top_p值：
          </td>
          <td>

            {{# if (d.task.compareType == 'top_p' || d.task.compareType == 'kpt' || d.task.compareType == 'all') { }}
            已作为对比变量
            {{# } else { }}

              <input type="number" autocomplete="off" id="topP" placeholder="top_p值" class="layui-input" style="width: auto;" value="{{d.task.topP}}">

            {{# } }}
          </td>
          <td>
            temperature值：
          </td>
          <td>

            {{# if (d.task.compareType == 'temperature' || d.task.compareType == 'kpt' || d.task.compareType == 'all') { }}
            已作为对比变量
            {{# } else { }}

              <input type="number" autocomplete="off" id="temperature" placeholder="temperature值" class="layui-input" style="width: auto;" value="{{d.task.temperature}}">

            {{# } }}
          </td>
        </tr>
        <tr>
          <td>
            文本分隔符：
          </td>
          <td>

            {{# if (d.task.compareType == 'text_delimiter' || d.task.compareType == 'all') { }}
            已作为对比变量
            {{# } else { }}

              <input type="text" autocomplete="off" id="textDelimiter" placeholder="文本分隔符" class="layui-input" style="width: auto;" value="{{d.task.textDelimiter}}">

            {{# } }}
          </td>
          <td>
            speed值：
          </td>
          <td>

            {{# if (d.task.compareType == 'speed' || d.task.compareType == 'all') { }}
            已作为对比变量
            {{# } else { }}

              <input type="number" autocomplete="off" id="speed" placeholder="speed值" class="layui-input" style="width: auto;" value="{{d.task.speed}}">

            {{# } }}
          </td>
          <td>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td>参考音频：</td>
          <td>

            {{# if (d.task.compareType == 'refer_audio') { }}
            已作为对比变量
            {{# } else { }}

                已选中待推理音频数量：<span id="audioSelectedCount">{{d.task.taskAudioList.length}}</span>
                <button type="button" class="layui-btn layui-btn-sm" id="audioSelect">音频选择</button>

            {{# } }}

          </td>
         <td>
           音色融合
         </td>
         <td>
           {{# if (d.task.compareType == 'inp_refs' || d.task.compareType == 'all') { }}
            已作为对比变量
           {{# } else { }}

             已选中待融合音频数量：<span id="inpRefsAudioSelectedCount">{{d.task.taskInpRefsAudioList.length}}</span>
             <button type="button" class="layui-btn layui-btn-sm" id="inpRefsAudioSelect">音频选择</button>

           {{# } }}
         </td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>推理文本：</td>
          <td colspan="5">
            已选中待推理文本数量：<span id="textManagerSelectedCount">{{d.task.taskTextList.length}}</span>
            <button type="button" class="layui-btn layui-btn-sm" id="textManager">文本管理</button>
          </td>
        </tr>
      </table>
        
      </div>
    </div>
  </div>

  {{# } }}
  
</script>